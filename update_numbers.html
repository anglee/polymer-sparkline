<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Sparkline</title>

  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css">
  <script src="bower_components/platform/platform.js"></script>
  <script src="bower_components/polymer/polymer.js"></script>
  <script src="bower_components/jquery/dist/jquery.js"></script>
  <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
  <script src="bower_components/lodash/dist/lodash.js"></script>

  <link rel="import" href="elements/pp-sparkline.html">

</head>
<body>

<polymer-element name="update-from-mouse" attributes="numbers">
  <script>
    var lastmousex=-1;
    var lastmousey=-1;
    var lastmousetime;
    var mousetravel = 0;
    var mpoints_max = 50;
    Polymer('update-from-mouse', {
      ready: function() {
        $('html').mousemove(function(e) {
          console.log("mousemove");
          var mousex = e.pageX;
          var mousey = e.pageY;
          if (lastmousex > -1) {
            mousetravel += Math.max( Math.abs(mousex-lastmousex), Math.abs(mousey-lastmousey) );
          }
          lastmousex = mousex;
          lastmousey = mousey;
        });

        var self = this;
        var update = function() {
          var md = new Date();
          var timenow = md.getTime();
          if (lastmousetime && lastmousetime!=timenow) {

            var pps = Math.round(mousetravel / (timenow - lastmousetime) * 1000);
            self.numbers.push(pps);
            if (self.numbers.length > mpoints_max) {
              self.numbers.splice(0,1);
            }
            mousetravel = 0;
          } else {
            console.log("update 3");
            self.numbers.push(0);
            if (self.numbers.length > mpoints_max) {
              self.numbers.splice(0,1);
            }
          }
          lastmousetime = timenow;
          setTimeout(update, 500);
        };
        setTimeout(update, 500);
      }
    });
  </script>
</polymer-element>

<polymer-element name="sparkline-label">
  <template>
    <update-from-mouse numbers="{{numbers}}"></update-from-mouse>
    <pp-sparkline numbers="{{numbers}}" info="{{info}}" show-avg></pp-sparkline>
    <div>min = {{info.min}}</div>
    <div>max = {{info.max}}</div>
    <div>avg = {{f(info.avg)}}</div>
    <div>cursor = {{info.cursor}}</div>
  </template>
  <script>
    Polymer('sparkline-label', {
      numbers: [10, 10, 10, 10, 10],
      ready: function() {},
      f: function(num) {
        if (num) {
          return num.toPrecision(6);
        }
      }
    });
  </script>
</polymer-element>

<sparkline-label></sparkline-label>

</body>
</html>
